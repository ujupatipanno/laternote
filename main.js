var g=Object.defineProperty;var w=Object.getOwnPropertyDescriptor;var T=Object.getOwnPropertyNames;var v=Object.prototype.hasOwnProperty;var f=(h,a)=>{for(var t in a)g(h,t,{get:a[t],enumerable:!0})},Y=(h,a,t,e)=>{if(a&&typeof a=="object"||typeof a=="function")for(let o of T(a))!v.call(h,o)&&o!==t&&g(h,o,{get:()=>a[o],enumerable:!(e=w(a,o))||e.enumerable});return h};var D=h=>Y(g({},"__esModule",{value:!0}),h);var M={};f(M,{default:()=>p});module.exports=D(M);var i=require("obsidian"),N={trashNotePath:"",addTimestamp:!1,timestampFormat:"YYYY-MM-DD HH:mm",moveDestinationPath:"",placeholderFormat:"YYYY-MM-DD"},p=class extends i.Plugin{constructor(){super(...arguments);this.appendQueue=Promise.resolve()}async onload(){await this.loadSettings(),this.addSettingTab(new d(this.app,this)),this.registerEvent(this.app.vault.on("rename",async(e,o)=>{this.settings.trashNotePath===o&&(this.settings.trashNotePath=e.path,await this.saveSettings(),new i.Notice(`\uC7A1\uB3D9\uC0AC\uB2C8 \uB178\uD2B8\uC758 \uC774\uB984\uC774 \uBCC0\uACBD\uB418\uC5C8\uC2B5\uB2C8\uB2E4: "${e.name}"`))})),[["set-trash-note","\uD604\uC7AC \uBB38\uC11C\uB97C \uC7A1\uB3D9\uC0AC\uB2C8 \uB178\uD2B8\uB85C \uC9C0\uC815","setTrashNote"],["move-selection-to-trash","\uC7A1\uB3D9\uC0AC\uB2C8 \uB178\uD2B8\uB85C \uC62E\uAE30\uAE30","moveSelectionToTrash",!0,"lucide-brush-cleaning"],["open-trash-note","\uC7A1\uB3D9\uC0AC\uB2C8 \uB178\uD2B8 \uC5F4\uAE30","openTrashNote",!1,"lucide-tool-case"],["move-trash-to-new-note","\uC7A1\uB3D9\uC0AC\uB2C8 \uB178\uD2B8 \uB0B4\uC6A9\uC744 \uAE30\uB85D \uB178\uD2B8\uB85C \uC62E\uAE30\uACE0 \uBE44\uC6B0\uAE30","moveTrashToNewNote"]].forEach(([e,o,n,s,l])=>{this.addCommand({id:e,name:o,...l&&{icon:l},...s?{editorCallback:r=>this[n](r)}:{callback:()=>this[n]()}})}),this.addRibbonIcon("lucide-brush-cleaning","\uC7A1\uB3D9\uC0AC\uB2C8 \uB178\uD2B8\uB85C \uC62E\uAE30\uAE30",async()=>{let e=this.app.workspace.getActiveViewOfType(i.MarkdownView);e?.editor?await this.moveSelectionToTrash(e.editor):new i.Notice("\uC5D0\uB514\uD130\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.")}),this.addRibbonIcon("lucide-tool-case","\uC7A1\uB3D9\uC0AC\uB2C8 \uB178\uD2B8 \uC5F4\uAE30",async()=>{await this.openTrashNote()})}async getActiveFile(){let t=this.app.workspace.getActiveViewOfType(i.MarkdownView);return t?.file?t.file:(new i.Notice("\uD604\uC7AC \uD30C\uC77C\uC744 \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4."),null)}async setTrashNote(){let t=await this.getActiveFile();t&&(this.settings.trashNotePath=t.path,await this.saveSettings(),new i.Notice(`\uC7A1\uB3D9\uC0AC\uB2C8 \uB178\uD2B8\uAC00 "${t.basename}"\uC73C\uB85C \uC9C0\uC815\uB418\uC5C8\uC2B5\uB2C8\uB2E4.`))}async moveSelectionToTrash(t){let e=await this.ensureTrashNoteFile();if(!e)return;if(this.app.workspace.getActiveFile()?.path===e.path){new i.Notice("\uC7A1\uB3D9\uC0AC\uB2C8 \uB178\uD2B8\uC5D0\uC11C\uB294 \uC774 \uBA85\uB839\uC744 \uC0AC\uC6A9\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.");return}let s=t.getSelection(),l,r;if(s)l=t.getCursor("from"),r=t.getCursor("to");else{let c=t.getCursor().line;s=t.getLine(c),l={line:c,ch:0},r={line:c+1,ch:0}}if(!s||s.trim()===""){new i.Notice("\uC62E\uAE38 \uB0B4\uC6A9\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.");return}t.replaceRange("",l,r),await this.appendToTrashNote(s)}async appendToTrashNote(t){return this.appendQueue=this.appendQueue.then(async()=>{try{let e=await this.ensureTrashNoteFile();if(!e)return;let o=await this.app.vault.read(e),n=o;if(o&&!o.endsWith(`
`)&&(n+=`
`),this.settings.addTimestamp){let s=this.getFormattedTimestamp();n+=`
`+s+`
`+t+`
`}else n+=`
`+t+`
`;await this.app.vault.modify(e,n)}catch(e){console.error(e),new i.Notice("\uC7A1\uB3D9\uC0AC\uB2C8 \uB178\uD2B8\uB85C \uC62E\uAE30\uB294 \uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4.")}}),this.appendQueue}getFormattedTimestamp(t){let e=new Date,o={YYYY:e.getFullYear().toString(),MM:String(e.getMonth()+1).padStart(2,"0"),DD:String(e.getDate()).padStart(2,"0"),HH:String(e.getHours()).padStart(2,"0"),mm:String(e.getMinutes()).padStart(2,"0")};return(t||this.settings.timestampFormat).replace(/YYYY|MM|DD|HH|mm/g,n=>o[n])}async openTrashNote(){try{let t=await this.ensureTrashNoteFile();if(!t)return;let e=this.app.workspace.getLeavesOfType("markdown").find(n=>n.view instanceof i.MarkdownView&&n.view.file?.path===t.path);if(e)this.app.workspace.setActiveLeaf(e,{focus:!0});else{let n=this.app.workspace.getLeaf(!1);await n.openFile(t),this.app.workspace.setActiveLeaf(n,{focus:!0})}let o=this.app.workspace.getActiveViewOfType(i.MarkdownView);if(o){let n=o.editor,s=n.lastLine(),l=n.getLine(s).length;n.setCursor({line:s,ch:l});let r=n.cm;if(r?.scrollDOM){let c=r.scrollDOM;c.scrollTop=c.scrollHeight-c.clientHeight}}}catch(t){console.error(t),new i.Notice("\uC7A1\uB3D9\uC0AC\uB2C8 \uB178\uD2B8\uB97C \uC5EC\uB294 \uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4.")}}async moveTrashToNewNote(){let t=await this.ensureTrashNoteFile();if(!t)return;let e=await this.app.vault.read(t);new m(this.app,this,async(o,n)=>{let s=this.sanitizeTitle(o.trim()||n.placeholderText);if(!s||!s.trim())return n.showError("\uC720\uD6A8\uD55C \uC81C\uBAA9\uC774 \uD544\uC694\uD569\uB2C8\uB2E4."),!1;let l=this.settings.moveDestinationPath||"",r=this.buildNotePath(l,s);try{return await this.app.vault.adapter.exists(r)?(n.showError("\uAC19\uC740 \uC774\uB984\uC758 \uB178\uD2B8\uAC00 \uC774\uBBF8 \uC874\uC7AC\uD569\uB2C8\uB2E4. \uB2E4\uB978 \uC81C\uBAA9\uC744 \uC785\uB825\uD574\uC8FC\uC138\uC694."),!1):(await this.app.vault.create(r,e),await this.app.vault.modify(t,""),new i.Notice(`"${s}" \uAE30\uB85D \uB178\uD2B8\uAC00 \uC0DD\uC131\uB418\uC5C8\uC2B5\uB2C8\uB2E4.`),!0)}catch(c){return console.error(c),n.showError("\uB178\uD2B8\uB97C \uC0DD\uC131\uD558\uAC70\uB098 \uC7A1\uB3D9\uC0AC\uB2C8 \uB178\uD2B8\uB97C \uBE44\uC6B0\uB294 \uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4."),!1}}).open()}sanitizeTitle(t){return t.replace(/[\\/:*?"<>|]/g,"-").trim()}buildNotePath(t,e){return t?`${t}/${e}.md`:`${e}.md`}async ensureTrashNoteFile(){try{let t=this.settings.trashNotePath?.trim();t||(t="later.md");let e=this.app.vault.getAbstractFileByPath(t);if(e instanceof i.TFile)return this.settings.trashNotePath||(this.settings.trashNotePath=e.path,await this.saveSettings()),e;let o=await this.app.vault.create(t,"");return this.settings.trashNotePath=o.path,await this.saveSettings(),new i.Notice(`\uC7A1\uB3D9\uC0AC\uB2C8 \uB178\uD2B8\uAC00 \uC5C6\uC5B4 \uAE30\uBCF8 \uD30C\uC77C\uC744 \uC0DD\uC131\uD588\uC2B5\uB2C8\uB2E4: ${o.path}`),o}catch(t){return console.error(t),new i.Notice("\uC7A1\uB3D9\uC0AC\uB2C8 \uB178\uD2B8 \uAE30\uBCF8 \uD30C\uC77C\uC744 \uC0DD\uC131\uD558\uB294 \uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4."),null}}async loadSettings(){this.settings=Object.assign({},N,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}},u=class extends i.SuggestModal{constructor(a,t,e){super(a),this.plugin=t,this.settingTab=e||null,this.setPlaceholder("\uC7A1\uB3D9\uC0AC\uB2C8 \uB178\uD2B8\uB85C \uC9C0\uC815\uD560 \uBB38\uC11C\uB97C \uAC80\uC0C9\uD558\uC138\uC694")}getSuggestions(a){let t=this.app.vault.getMarkdownFiles();return a?t.filter(e=>e.basename.toLowerCase().includes(a.toLowerCase())):t}renderSuggestion(a,t){t.createEl("div",{text:a.basename}),t.createEl("small",{text:a.path,cls:"obsidian-suggests-path"})}async onChooseSuggestion(a,t){if(this.plugin.settings.trashNotePath=a.path,await this.plugin.saveSettings(),new i.Notice(`\uC7A1\uB3D9\uC0AC\uB2C8 \uB178\uD2B8\uAC00 "${a.basename}"\uC73C\uB85C \uC9C0\uC815\uB418\uC5C8\uC2B5\uB2C8\uB2E4.`),this.settingTab?.trashNoteSetting){let e=a.path?`\uD604\uC7AC \uC9C0\uC815: ${a.path}`:"\uD604\uC7AC \uC9C0\uC815\uB41C \uC7A1\uB3D9\uC0AC\uB2C8 \uB178\uD2B8\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4.";this.settingTab.trashNoteSetting.setDesc(e)}}},m=class extends i.Modal{constructor(a,t,e){super(a),this.plugin=t,this.onSubmit=e,this.placeholderText=this.plugin.getFormattedTimestamp(this.plugin.settings.placeholderFormat||"YYYY-MM-DD")}showError(a){this.statusEl.setText(a),this.statusEl.addClass("mod-warning")}clearMessage(){this.statusEl.setText(""),this.statusEl.removeClass("mod-warning")}onOpen(){let{contentEl:a}=this;a.createEl("h3",{text:"\uAE30\uB85D \uB178\uD2B8\uC758 \uC81C\uBAA9\uC744 \uC785\uB825\uD574\uC8FC\uC138\uC694"}),this.titleInput=a.createEl("input",{type:"text",placeholder:this.placeholderText}),this.statusEl=a.createDiv();let t=a.createDiv({cls:"modal-button-container"}),e=t.createEl("button",{text:"\uD655\uC778",cls:"mod-cta"});e.onclick=async()=>{this.clearMessage();let n=this.titleInput.value.trim()||this.placeholderText;await this.onSubmit(n,this)!==!1&&this.close()};let o=t.createEl("button",{text:"\uCDE8\uC18C"});o.onclick=()=>this.close(),this.titleInput.focus(),this.titleInput.addEventListener("keydown",n=>{n.key==="Enter"?e.click():n.key==="Escape"&&this.close()})}onClose(){let{contentEl:a}=this;a.empty()}},d=class extends i.PluginSettingTab{constructor(t,e){super(t,e);this.trashNoteSetting=null;this.plugin=e}display(){let{containerEl:t}=this;t.empty();let e=this.plugin.getFormattedTimestamp(this.plugin.settings.timestampFormat||"YYYY-MM-DD HH:mm"),o=this.plugin.settings.trashNotePath?`\uD604\uC7AC \uC9C0\uC815: ${this.plugin.settings.trashNotePath}`:"\uD604\uC7AC \uC9C0\uC815\uB41C \uC7A1\uB3D9\uC0AC\uB2C8 \uB178\uD2B8\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4.";this.trashNoteSetting=new i.Setting(t).setName("\uC7A1\uB3D9\uC0AC\uB2C8 \uB178\uD2B8 \uD30C\uC77C").setDesc(o).addButton(s=>{s.setButtonText("\uAC80\uC0C9\uD558\uC5EC \uC9C0\uC815"),s.onClick(()=>{new u(this.app,this.plugin,this).open()})}),new i.Setting(t).setName("\uD0C0\uC784\uC2A4\uD0EC\uD504 \uC790\uB3D9 \uCD94\uAC00").setDesc("\uC774\uB3D9\uD55C \uB0B4\uC6A9 \uB9E8 \uC55E\uC5D0 \uC790\uB3D9\uC73C\uB85C \uD0C0\uC784\uC2A4\uD0EC\uD504\uB97C \uCD94\uAC00\uD569\uB2C8\uB2E4.").addToggle(s=>{s.setValue(this.plugin.settings.addTimestamp),s.onChange(async l=>{this.plugin.settings.addTimestamp=l,await this.plugin.saveSettings()})});let n=new i.Setting(t).setName("\uD0C0\uC784\uC2A4\uD0EC\uD504 \uD615\uC2DD").setDesc(`\uAE30\uBCF8 \uD615\uC2DD: YYYY-MM-DD HH:mm (YYYY, MM, DD, HH, mm). \uD604\uC7AC \uC608\uC2DC: ${e}`).addText(s=>{s.setValue(this.plugin.settings.timestampFormat),s.onChange(async l=>{this.plugin.settings.timestampFormat=l,await this.plugin.saveSettings();let r=this.plugin.getFormattedTimestamp(l||"YYYY-MM-DD HH:mm");n.setDesc(`\uAE30\uBCF8 \uD615\uC2DD: YYYY-MM-DD HH:mm (YYYY, MM, DD, HH, mm). \uD604\uC7AC \uC608\uC2DC: ${r}`)})});new i.Setting(t).setName("\uAE30\uB85D \uB178\uD2B8 \uC81C\uBAA9 placeholder").setDesc("YYYY, MM, DD, HH, mm\uB97C \uC0AC\uC6A9\uD560 \uC218 \uC788\uC2B5\uB2C8\uB2E4. \uBE44\uC6CC\uB450\uBA74 \uAE30\uBCF8\uAC12(YYYY-MM-DD) \uC0AC\uC6A9").addText(s=>{s.setPlaceholder("YYYY-MM-DD"),s.setValue(this.plugin.settings.placeholderFormat),s.onChange(async l=>{this.plugin.settings.placeholderFormat=l||"YYYY-MM-DD",await this.plugin.saveSettings()})}),new i.Setting(t).setName("\uAE30\uB85D \uB178\uD2B8 \uC0DD\uC131 \uC704\uCE58").setDesc("\uC7A1\uB3D9\uC0AC\uB2C8 \uB178\uD2B8 \uB0B4\uC6A9\uC744 \uC62E\uAE38 \uB54C \uC0C8 \uB178\uD2B8\uB97C \uC0DD\uC131\uD560 \uD3F4\uB354").addDropdown(s=>{let l=this.app.vault.getAllLoadedFiles().filter(r=>r instanceof i.TFolder).map(r=>r.path);s.addOption("","Vault \uB8E8\uD2B8"),l.forEach(r=>{s.addOption(r,r)}),s.setValue(this.plugin.settings.moveDestinationPath),s.onChange(async r=>{this.plugin.settings.moveDestinationPath=r,await this.plugin.saveSettings()})})}};
