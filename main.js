"use strict";var g=Object.defineProperty;var T=Object.getOwnPropertyDescriptor;var w=Object.getOwnPropertyNames;var v=Object.prototype.hasOwnProperty;var Y=(h,l)=>{for(var t in l)g(h,t,{get:l[t],enumerable:!0})},D=(h,l,t,e)=>{if(l&&typeof l=="object"||typeof l=="function")for(let s of w(l))!v.call(h,s)&&s!==t&&g(h,s,{get:()=>l[s],enumerable:!(e=T(l,s))||e.enumerable});return h};var N=h=>D(g({},"__esModule",{value:!0}),h);var S={};Y(S,{default:()=>p});module.exports=N(S);var i=require("obsidian"),f={trashNotePath:"",addTimestamp:!1,timestampFormat:"YYYY-MM-DD HH:mm",moveDestinationPath:"",placeholderFormat:"YYYY-MM-DD"},p=class extends i.Plugin{constructor(){super(...arguments);this.appendQueue=Promise.resolve()}async onload(){await this.loadSettings(),this.addSettingTab(new d(this.app,this)),this.registerEvent(this.app.vault.on("rename",async(e,s)=>{this.settings.trashNotePath===s&&(this.settings.trashNotePath=e.path,await this.saveSettings(),new i.Notice(`\uC7A1\uB3D9\uC0AC\uB2C8 \uB178\uD2B8\uC758 \uC774\uB984\uC774 \uBCC0\uACBD\uB418\uC5C8\uC2B5\uB2C8\uB2E4: "${e.name}"`))})),[["set-trash-note","\uD604\uC7AC \uBB38\uC11C\uB97C \uC7A1\uB3D9\uC0AC\uB2C8 \uB178\uD2B8\uB85C \uC9C0\uC815","setTrashNote"],["move-selection-to-trash","\uC7A1\uB3D9\uC0AC\uB2C8 \uB178\uD2B8\uB85C \uC62E\uAE30\uAE30","moveSelectionToTrash",!0,"brush-cleaning"],["open-trash-note","\uC7A1\uB3D9\uC0AC\uB2C8 \uB178\uD2B8 \uC5F4\uAE30","openTrashNote",!1,"tool-case"],["move-trash-to-new-note","\uC7A1\uB3D9\uC0AC\uB2C8 \uB178\uD2B8 \uB0B4\uC6A9\uC744 \uAE30\uB85D \uB178\uD2B8\uB85C \uC62E\uAE30\uACE0 \uBE44\uC6B0\uAE30","moveTrashToNewNote"]].forEach(([e,s,n,a,o])=>{this.addCommand({id:e,name:s,...o&&{icon:o},...a?{editorCallback:r=>this[n](r)}:{callback:()=>this[n]()}})}),this.addRibbonIcon("tool-case","\uC7A1\uB3D9\uC0AC\uB2C8 \uB178\uD2B8 \uC5F4\uAE30",async()=>{await this.openTrashNote()})}async getActiveFile(){let t=this.app.workspace.getActiveViewOfType(i.MarkdownView);return t?.file?t.file:(new i.Notice("\uD604\uC7AC \uD30C\uC77C\uC744 \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4."),null)}async setTrashNote(){let t=await this.getActiveFile();t&&(this.settings.trashNotePath=t.path,await this.saveSettings(),new i.Notice(`\uC7A1\uB3D9\uC0AC\uB2C8 \uB178\uD2B8\uAC00 "${t.basename}"\uC73C\uB85C \uC9C0\uC815\uB418\uC5C8\uC2B5\uB2C8\uB2E4.`))}async moveSelectionToTrash(t){let e=await this.ensureTrashNoteFile();if(!e)return;if(this.app.workspace.getActiveFile()?.path===e.path){new i.Notice("\uC7A1\uB3D9\uC0AC\uB2C8 \uB178\uD2B8\uC5D0\uC11C\uB294 \uC774 \uBA85\uB839\uC744 \uC0AC\uC6A9\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.");return}let a=t.getSelection(),o,r;if(a)o=t.getCursor("from"),r=t.getCursor("to");else{let c=t.getCursor().line;a=t.getLine(c),o={line:c,ch:0},r={line:c+1,ch:0}}t.replaceRange("",o,r),await this.appendToTrashNote(a)}async appendToTrashNote(t){return this.appendQueue=this.appendQueue.then(async()=>{try{let e=await this.ensureTrashNoteFile();if(!e)return;let s=await this.app.vault.read(e),n=s;if(s&&!s.endsWith(`
`)&&(n+=`
`),this.settings.addTimestamp){let a=this.getFormattedTimestamp();n+=`
`+a+`
`+t+`
`}else n+=`
`+t+`
`;await this.app.vault.modify(e,n)}catch(e){console.error(e),new i.Notice("\uC7A1\uB3D9\uC0AC\uB2C8 \uB178\uD2B8\uB85C \uC62E\uAE30\uB294 \uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4.")}}),this.appendQueue}getFormattedTimestamp(t){let e=new Date,s={YYYY:e.getFullYear().toString(),MM:String(e.getMonth()+1).padStart(2,"0"),DD:String(e.getDate()).padStart(2,"0"),HH:String(e.getHours()).padStart(2,"0"),mm:String(e.getMinutes()).padStart(2,"0")};return(t||this.settings.timestampFormat).replace(/YYYY|MM|DD|HH|mm/g,n=>s[n])}async openTrashNote(){try{let t=await this.ensureTrashNoteFile();if(!t)return;let e=this.app.workspace.getLeaf(!1);await e.openFile(t),this.app.workspace.setActiveLeaf(e,{focus:!0})}catch(t){console.error(t),new i.Notice("\uC7A1\uB3D9\uC0AC\uB2C8 \uB178\uD2B8\uB97C \uC5EC\uB294 \uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4.")}}async moveTrashToNewNote(){let t=await this.ensureTrashNoteFile();if(!t)return;let e=await this.app.vault.read(t);new m(this.app,this,async(s,n)=>{let a=this.sanitizeTitle(s.trim()||n.placeholderText);if(!a||!a.trim())return n.showError("\uC720\uD6A8\uD55C \uC81C\uBAA9\uC774 \uD544\uC694\uD569\uB2C8\uB2E4."),!1;let o=this.settings.moveDestinationPath||"",r=this.buildNotePath(o,a);try{return await this.app.vault.adapter.exists(r)?(n.showError("\uAC19\uC740 \uC774\uB984\uC758 \uB178\uD2B8\uAC00 \uC774\uBBF8 \uC874\uC7AC\uD569\uB2C8\uB2E4. \uB2E4\uB978 \uC81C\uBAA9\uC744 \uC785\uB825\uD574\uC8FC\uC138\uC694."),!1):(await this.app.vault.create(r,e),await this.app.vault.modify(t,""),new i.Notice(`"${a}" \uAE30\uB85D \uB178\uD2B8\uAC00 \uC0DD\uC131\uB418\uC5C8\uC2B5\uB2C8\uB2E4.`),!0)}catch(c){return console.error(c),n.showError("\uB178\uD2B8\uB97C \uC0DD\uC131\uD558\uAC70\uB098 \uC7A1\uB3D9\uC0AC\uB2C8 \uB178\uD2B8\uB97C \uBE44\uC6B0\uB294 \uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4."),!1}}).open()}sanitizeTitle(t){return t.replace(/[\\/:*?"<>|]/g,"-").trim()}buildNotePath(t,e){return t?`${t}/${e}.md`:`${e}.md`}async ensureTrashNoteFile(){try{let t=this.settings.trashNotePath?.trim();t||(t="later.md");let e=this.app.vault.getAbstractFileByPath(t);if(e instanceof i.TFile)return this.settings.trashNotePath||(this.settings.trashNotePath=e.path,await this.saveSettings()),e;let s=await this.app.vault.create(t,"");return this.settings.trashNotePath=s.path,await this.saveSettings(),new i.Notice(`\uC7A1\uB3D9\uC0AC\uB2C8 \uB178\uD2B8\uAC00 \uC5C6\uC5B4 \uAE30\uBCF8 \uD30C\uC77C\uC744 \uC0DD\uC131\uD588\uC2B5\uB2C8\uB2E4: ${s.path}`),s}catch(t){return console.error(t),new i.Notice("\uC7A1\uB3D9\uC0AC\uB2C8 \uB178\uD2B8 \uAE30\uBCF8 \uD30C\uC77C\uC744 \uC0DD\uC131\uD558\uB294 \uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4."),null}}async loadSettings(){this.settings=Object.assign({},f,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}},u=class extends i.SuggestModal{constructor(t,e,s){super(t);this.plugin=e,this.settingTab=s||null,this.setPlaceholder("\uC7A1\uB3D9\uC0AC\uB2C8 \uB178\uD2B8\uB85C \uC9C0\uC815\uD560 \uBB38\uC11C\uB97C \uAC80\uC0C9\uD558\uC138\uC694")}getSuggestions(t){let e=this.app.vault.getMarkdownFiles();return t?e.filter(s=>s.basename.toLowerCase().includes(t.toLowerCase())):e}renderSuggestion(t,e){e.createEl("div",{text:t.basename}),e.createEl("small",{text:t.path,cls:"obsidian-suggests-path"})}async onChooseSuggestion(t,e){if(this.plugin.settings.trashNotePath=t.path,await this.plugin.saveSettings(),new i.Notice(`\uC7A1\uB3D9\uC0AC\uB2C8 \uB178\uD2B8\uAC00 "${t.basename}"\uC73C\uB85C \uC9C0\uC815\uB418\uC5C8\uC2B5\uB2C8\uB2E4.`),this.settingTab?.trashNoteSetting){let s=t.path?`\uD604\uC7AC \uC9C0\uC815: ${t.path}`:"\uD604\uC7AC \uC9C0\uC815\uB41C \uC7A1\uB3D9\uC0AC\uB2C8 \uB178\uD2B8\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4.";this.settingTab.trashNoteSetting.setDesc(s)}}},m=class extends i.Modal{constructor(t,e,s){super(t);this.plugin=e,this.onSubmit=s,this.placeholderText=this.plugin.getFormattedTimestamp(this.plugin.settings.placeholderFormat||"YYYY-MM-DD")}showError(t){this.statusEl.setText(t),this.statusEl.addClass("mod-warning")}clearMessage(){this.statusEl.setText(""),this.statusEl.removeClass("mod-warning")}onOpen(){let{contentEl:t}=this;t.createEl("h3",{text:"\uAE30\uB85D \uB178\uD2B8\uC758 \uC81C\uBAA9\uC744 \uC785\uB825\uD574\uC8FC\uC138\uC694"}),this.titleInput=t.createEl("input",{type:"text",placeholder:this.placeholderText}),this.statusEl=t.createDiv();let e=t.createDiv({cls:"modal-button-container"}),s=e.createEl("button",{text:"\uD655\uC778",cls:"mod-cta"});s.onclick=async()=>{this.clearMessage();let a=this.titleInput.value.trim()||this.placeholderText;await this.onSubmit(a,this)!==!1&&this.close()};let n=e.createEl("button",{text:"\uCDE8\uC18C"});n.onclick=()=>this.close(),this.titleInput.focus(),this.titleInput.addEventListener("keydown",a=>{a.key==="Enter"?s.click():a.key==="Escape"&&this.close()})}onClose(){let{contentEl:t}=this;t.empty()}},d=class extends i.PluginSettingTab{constructor(t,e){super(t,e);this.trashNoteSetting=null;this.plugin=e}display(){let{containerEl:t}=this;t.empty();let e=this.plugin.getFormattedTimestamp(this.plugin.settings.timestampFormat||"YYYY-MM-DD HH:mm"),s=this.plugin.settings.trashNotePath?`\uD604\uC7AC \uC9C0\uC815: ${this.plugin.settings.trashNotePath}`:"\uD604\uC7AC \uC9C0\uC815\uB41C \uC7A1\uB3D9\uC0AC\uB2C8 \uB178\uD2B8\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4.";this.trashNoteSetting=new i.Setting(t).setName("\uC7A1\uB3D9\uC0AC\uB2C8 \uB178\uD2B8 \uD30C\uC77C").setDesc(s).addButton(a=>{a.setButtonText("\uAC80\uC0C9\uD558\uC5EC \uC9C0\uC815"),a.onClick(()=>{new u(this.app,this.plugin,this).open()})}),new i.Setting(t).setName("\uD0C0\uC784\uC2A4\uD0EC\uD504 \uC790\uB3D9 \uCD94\uAC00").setDesc("\uC774\uB3D9\uD55C \uB0B4\uC6A9 \uB9E8 \uC55E\uC5D0 \uC790\uB3D9\uC73C\uB85C \uD0C0\uC784\uC2A4\uD0EC\uD504\uB97C \uCD94\uAC00\uD569\uB2C8\uB2E4.").addToggle(a=>{a.setValue(this.plugin.settings.addTimestamp),a.onChange(async o=>{this.plugin.settings.addTimestamp=o,await this.plugin.saveSettings()})});let n=new i.Setting(t).setName("\uD0C0\uC784\uC2A4\uD0EC\uD504 \uD615\uC2DD").setDesc(`\uAE30\uBCF8 \uD615\uC2DD: YYYY-MM-DD HH:mm (YYYY, MM, DD, HH, mm). \uD604\uC7AC \uC608\uC2DC: ${e}`).addText(a=>{a.setValue(this.plugin.settings.timestampFormat),a.onChange(async o=>{this.plugin.settings.timestampFormat=o,await this.plugin.saveSettings();let r=this.plugin.getFormattedTimestamp(o||"YYYY-MM-DD HH:mm");n.setDesc(`\uAE30\uBCF8 \uD615\uC2DD: YYYY-MM-DD HH:mm (YYYY, MM, DD, HH, mm). \uD604\uC7AC \uC608\uC2DC: ${r}`)})});new i.Setting(t).setName("\uAE30\uB85D \uB178\uD2B8 \uC81C\uBAA9 placeholder").setDesc("YYYY, MM, DD, HH, mm\uB97C \uC0AC\uC6A9\uD560 \uC218 \uC788\uC2B5\uB2C8\uB2E4. \uBE44\uC6CC\uB450\uBA74 \uAE30\uBCF8\uAC12(YYYY-MM-DD) \uC0AC\uC6A9").addText(a=>{a.setPlaceholder("YYYY-MM-DD"),a.setValue(this.plugin.settings.placeholderFormat),a.onChange(async o=>{this.plugin.settings.placeholderFormat=o||"YYYY-MM-DD",await this.plugin.saveSettings()})}),new i.Setting(t).setName("\uAE30\uB85D \uB178\uD2B8 \uC0DD\uC131 \uC704\uCE58").setDesc("\uC7A1\uB3D9\uC0AC\uB2C8 \uB178\uD2B8 \uB0B4\uC6A9\uC744 \uC62E\uAE38 \uB54C \uC0C8 \uB178\uD2B8\uB97C \uC0DD\uC131\uD560 \uD3F4\uB354").addDropdown(a=>{let o=this.app.vault.getAllLoadedFiles().filter(r=>r instanceof i.TFolder).map(r=>r.path);a.addOption("","Vault \uB8E8\uD2B8"),o.forEach(r=>{a.addOption(r,r)}),a.setValue(this.plugin.settings.moveDestinationPath),a.onChange(async r=>{this.plugin.settings.moveDestinationPath=r,await this.plugin.saveSettings()})})}};
